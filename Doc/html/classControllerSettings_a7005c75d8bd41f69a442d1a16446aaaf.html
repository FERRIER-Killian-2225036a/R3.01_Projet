<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cyphub.tech: ControllerSettings\SupportAction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="favicon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cyphub.tech
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Généré par Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Recherche','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Recherche');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('classControllerSettings_a7005c75d8bd41f69a442d1a16446aaaf.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="contents">
<a id="a7005c75d8bd41f69a442d1a16446aaaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7005c75d8bd41f69a442d1a16446aaaf">&#9670;&nbsp;</a></span>SupportAction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ControllerSettings::SupportAction </td>
          <td>(</td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$A_parametres</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">array&#160;</td>
          <td class="paramname"><em>$A_postParams</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Méthode de gestion coté utilisateur des tickets de support depuis la vue des parametres on peut créer un ticket de support, voir les tickets actifs, voir les tickets clos on verifie que l'utilisateur est connecté, on verifie que la requete est bien un post, on sécurise les inputs et on les envois au model pour créer un ticket de support</p>
<dl class="params"><dt>Paramètres</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array&#160;|&#160;null</td><td class="paramname">$A_parametres</td><td></td></tr>
    <tr><td class="paramtype">array&#160;|&#160;null</td><td class="paramname">$A_postParams</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Renvoie</dt><dd>void </dd></dl>
<div class="fragment"><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                                                                                         : <span class="keywordtype">void</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keywordflow">if</span> ($_SERVER[<span class="stringliteral">&quot;REQUEST_METHOD&quot;</span>] === <span class="stringliteral">&quot;POST&quot;</span>) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classSessionManager_a6eacce9cf70e20f6206f1b2c01f6c439.html#a6eacce9cf70e20f6206f1b2c01f6c439">SessionManager::isUserConnected</a>()) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <span class="keywordflow">if</span> (isset($A_postParams[<span class="stringliteral">&quot;SubmitSupport&quot;</span>]) &amp;&amp; isset($A_postParams[<span class="stringliteral">&quot;Content&quot;</span>]) &amp;&amp; isset($A_postParams[<span class="stringliteral">&quot;Subject&quot;</span>])) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    $Content = $A_postParams[<span class="stringliteral">&quot;Content&quot;</span>];</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    $Content = htmlspecialchars($Content);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    $Subject = $A_postParams[<span class="stringliteral">&quot;Subject&quot;</span>];</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                    $Subject = htmlspecialchars($Subject);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                    <span class="keywordflow">if</span> (strlen($Subject) &gt; 200) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                        $Subject = substr($Subject, 0, 200);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                    }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    <span class="keywordflow">if</span> ($Subject != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; $Content != <span class="stringliteral">&quot;&quot;</span>) {</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                        $status = (<span class="keyword">new</span> <a class="code" href="classTicket.html">Ticket</a>())-&gt;createTicket($_SESSION[<span class="stringliteral">&quot;Mail&quot;</span>], $Content, <span class="stringliteral">&quot;inProgress&quot;</span>, $Subject, $_SESSION[<span class="stringliteral">&quot;UserId&quot;</span>]);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                        <span class="keywordflow">if</span> ($status != <span class="keyword">false</span>) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                            header(<span class="stringliteral">&quot;Location: /Settings/Support&quot;</span>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                            die();</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                            error_log(<span class="stringliteral">&quot;error : ticket not created, issues with db&quot;</span>);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                        }</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                        error_log(<span class="stringliteral">&quot;error : ticket not created, empty fields&quot;</span>);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                    }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                (<span class="keyword">new</span> <a class="code" href="classUserSite.html">UserSite</a>)-&gt;incrementAlertLevelUser($_SESSION[<span class="stringliteral">&quot;UserId&quot;</span>]);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                error_log(<span class="stringliteral">&quot;error : invalid or malicious request&quot;</span>);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                header(<span class="stringliteral">&quot;Location: / &quot;</span>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                die();</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classSessionManager_a6eacce9cf70e20f6206f1b2c01f6c439.html#a6eacce9cf70e20f6206f1b2c01f6c439">SessionManager::isUserConnected</a>()) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            $tempTicket = <span class="keyword">new</span> <a class="code" href="classTicket.html">Ticket</a>();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            $ArrayOfTicketId = $tempTicket-&gt;getAllTicketIdOfUser($_SESSION[<span class="stringliteral">&quot;UserId&quot;</span>]);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            $ArrayOfTicket = array();</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">foreach</span> ($ArrayOfTicketId as $id) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                $ArrayOfTicket[] = <span class="keyword">new</span> <a class="code" href="classTicketModel.html">TicketModel</a>($id);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <a class="code" href="classMotorView_a958b493a9fb4e0febfbf02eb7376da11.html#a958b493a9fb4e0febfbf02eb7376da11">MotorView::show</a>(<span class="stringliteral">&#39;profileSettings/support&#39;</span>, array(<span class="stringliteral">&quot;ArrayOfTicket&quot;</span> =&gt; $ArrayOfTicket));</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            header(<span class="stringliteral">&quot;Location: / &quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            die();</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    }</div>
<div class="ttc" id="aclassMotorView_a958b493a9fb4e0febfbf02eb7376da11_html_a958b493a9fb4e0febfbf02eb7376da11"><div class="ttname"><a href="classMotorView_a958b493a9fb4e0febfbf02eb7376da11.html#a958b493a9fb4e0febfbf02eb7376da11">MotorView\show</a></div><div class="ttdeci">static show(string $viewPath, array $mapOfModelContent=array())</div><div class="ttdef"><b>Definition:</b> MotorView.php:50</div></div>
<div class="ttc" id="aclassSessionManager_a6eacce9cf70e20f6206f1b2c01f6c439_html_a6eacce9cf70e20f6206f1b2c01f6c439"><div class="ttname"><a href="classSessionManager_a6eacce9cf70e20f6206f1b2c01f6c439.html#a6eacce9cf70e20f6206f1b2c01f6c439">SessionManager\isUserConnected</a></div><div class="ttdeci">static isUserConnected()</div><div class="ttdef"><b>Definition:</b> SessionManager.php:35</div></div>
<div class="ttc" id="aclassTicketModel_html"><div class="ttname"><a href="classTicketModel.html">TicketModel</a></div><div class="ttdef"><b>Definition:</b> TicketModel.php:20</div></div>
<div class="ttc" id="aclassTicket_html"><div class="ttname"><a href="classTicket.html">Ticket</a></div><div class="ttdef"><b>Definition:</b> Ticket.php:29</div></div>
<div class="ttc" id="aclassUserSite_html"><div class="ttname"><a href="classUserSite.html">UserSite</a></div><div class="ttdef"><b>Definition:</b> UserSite.php:39</div></div>
</div><!-- fragment -->
<p class="reference">Références <a class="el" href="classSessionManager_a6eacce9cf70e20f6206f1b2c01f6c439.html#a6eacce9cf70e20f6206f1b2c01f6c439">SessionManager\isUserConnected()</a>, et <a class="el" href="classMotorView_a958b493a9fb4e0febfbf02eb7376da11.html#a958b493a9fb4e0febfbf02eb7376da11">MotorView\show()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classControllerSettings.html">ControllerSettings</a></li>
    <li class="footer">Généré par <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
